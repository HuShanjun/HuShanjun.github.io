#  mysql 事务

## 一. 事务的定义

​	由一组sql语句组成的逻辑处理单元

## 二.事务的基本属性(ACID)

- 原子性（atomicity）: 事务是一个原子操作单元，其对数据的修改，要么全部执行，要么全部都不执行。

- 一致性（Consistant）: 在事务开始和结束时，数据必须保持一致状态，

  ​	**含义一：** 所有相关数据规则都必须应用于数据的修改，以保持数据的完整性。

  ​	**含义二：** 事务结束时，所有的内部数据结构（B+树或双向链表）也必须正确

- 隔离性（Isolation）: 数据库提供一定的隔离机制，保证事务在不受外部并发操作的影响的**“独立”**环境中运行。这意味着事务处理过程中的中间状态对外部环境是不可见的，反之亦然。

- 持久性（Durable）: 事务完成之后，它对数据库的修改是永久性的，即使出现系统故障也能够保持。

## 三.事务控制

- **start transaction**或者 **begin** 语句开始一项新事物，如果在锁表期间，隐含的unlock table将会被执行
- **commit**和 **rollback**用来提交或者回滚事务
- **chain** 和 **release** 分别用来定义提交事务或者回滚后的操作。
  - **chain** 立即开始一项新事物，并且和刚才的事务具有相同的隔离级别
  - **release** 会断开和客户端的连接
- **save point** 指定回滚事务的一部分，但是不能指定提交事务的一部分。

## 四. 并发事务处理带来的问题

- **更新丢失：**当多个事务选择同一行并基于 **最初选定的值** 进行修改时，由于每个事务不知道其他事务的存在，就会出现更新丢失的情况 --- 最后的更新会覆盖之前的更新。
- **脏读：** 一个事务正在对一条记录进行更改，在这个事务提交完成前，这条记录就处于不一致的状态；这时另一个事务也来读取同一条记录，如果不加控制就读取了这些脏数据，并据此做进一步管理，就会产生未提交的数据依赖关系。
- **不可重复读:** 一个事务读取数据后的某个时间，再次读取之前读过的某些数据，却发现数据已经改变或者已经被删除。这种现象叫做 “**不可重复读**”
- **幻读：** 一个事务按照相同的查询条件重新读取以前检索过的数据，却发现其他事务插入了满足其查询条件的新数据，这种现象称为 **幻读**

## 五. 事务的隔离级别

数据库实现隔离级别的两种方式

- 读数据前对其进行加锁，阻止其他事务对数据进行修改
- **多版本并发控制（MCC && MVCC）** multi version concurrency control 通过一定的机制生成一个数据请求时间点的一致性 **快照** ，并用这个快照提供一定级别（语句或事物）的一致性读取。

